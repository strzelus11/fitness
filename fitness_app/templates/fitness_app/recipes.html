{% extends "fitness_app/layout.html" %} {% block title %} Recipes {% endblock %}
{% block body %}

<div class="row text-center" id="recipe-list">
    <h2><a href="{% url 'categories' %}">All Categories</a></h2>
	{% for recipe in data %}
	<div class="col-md-4 my-3 recipe">
		<div class="card h-100">
			<a
				class="title-link"
				href="{% url 'recipe' id=recipe.id title=recipe.title|slugify %}"
				><img src="{{ recipe.image }}" class="card-img-top" alt="..."
			/></a>
			<div class="card-body text-center" style="padding-bottom: 6em">
				<a
					class="title-link"
					href="{% url 'recipe' id=recipe.id title=recipe.title|slugify %}"
					><h5 class="card-title fw-bold">{{ recipe.title }}</h5></a
				>
				{% for category in recipe.categories %}
				<a href="{% url 'category' category|slugify %}" class="card-link">{{ category }}</a>
				{% endfor %}
				<a
					href="{% url 'recipe' id=recipe.id title=recipe.title|slugify %}"
					class="btn btn-primary btn-card-bottom"
					>View recipe</a
				>
			</div>
		</div>
	</div>
	{% endfor %}
</div>
{% if data.has_next %}
<button
	class="btn btn-light"
	id="load-more"
	data-start="30"
>
	Load more
</button>
<a href="#" class="scroll-to-top">&#11014;</a>
{% endif %}

<script>
	$(document).ready(function () {
		$("#load-more").click(function () {
			var url = "{{ request.path }}?start=" + $(this).data("start");
			$.get(url, function (data) {
				var recipes = $(data).find("#recipe-list .recipe");
				$("#recipe-list").append(recipes);
				if (!$(data).find("#load-more").length) {
					$("#load-more").hide();
				} else {
					$("#load-more").data(
						"start",
						parseInt($("#load-more").data("start")) + 15
					);
				}
			});
		});
	});

	$(window).scroll(function () {
		if ($(this).scrollTop() > 100) {
			$(".scroll-to-top").fadeIn();
		} else {
			$(".scroll-to-top").fadeOut();
		}
	});

	$(".scroll-to-top").click(function (e) {
		e.preventDefault();
		$("html, body").animate({ scrollTop: 0 }, "300");
	});
</script>
{% endblock %}
